# 2. Application Layer

## 네트워크 애플리케이션
네트워크 애플리케이션은 우리가 사용하는 모든 인터넷 서비스를 의미한다.
네트워크 애플리케이션 개발의 중심은 다른 위치의 종단 시스템에서 동작하고 네트워크를 통해 서로 통신하는 프로그램을 작성하는 것이다.
예를 들어 클라이언트의 웹 브라우저 프로그램과 웹 서버 호스트가 통신할 수 있다. 따라서 우리는 새로운 애플리케이션을 개발할 때 여러 종단 시스템
에서 실행되는 소프트웨어를 작성해야 한다. 중요한 것은 우리가 라우터나 링크 계층 스위치처럼 네트워크 코어 장비에서 실행되는 소프트웨어까지 작성할 필요는
없다는 것이다. 네트워크 코어 장비는 네트워크 계층 및 그 하위 계층에서 기능한다. 오직 종단 시스템에만 애플리케이션 소프트웨어가 존재한다.

### 네트워크 애플리케이션 구조
1. 클라이언트-서버 구조 
   - 클라이언트 호스트는 가끔 또는 항상 켜져 있다.
   - 서버는 고정 IP 주소를 갖는다. 클라이언트는 서로 직접적으로 통신하지 않는다.
   - 데이터 센터가 강력한 가상의 서버를 생성하는 역할로 사용된다.
2. P2P 구조
   - peer라는 간헐적으로 연결된 호스트 쌍이 서로 직접 통신한다. 
   - 피어는 서비스 제공자가 소유하지 않고, 사용자가 제어하는 데스크톱과 랩톱이다. ex) BitTorrent 
   - 자기 확장성을 가진다. 피어가 곧 제공자이자 사용자이다.

### 프로세스 간 통신
다른 호스트(운영체제)에서 실행되는 프로세스와 어떻게 통신할까? 2개의 종단 시스템에서 프로세스는 컴퓨터 네트워크를 통한 메시지 교환으로 서로 통신한다.

네트워크에서 서로 메시지를 보내는 두 프로세스를 각각 클라이언트와 서버로 정의한다. 클라이언트는 다른 프로세스와 세션을 시작하려고 접속을 초기화하는 프로세스를 
말하며, 세션을 시작하기 위해 접속을 기다리는 프로세스를 서버라 한다. P2P 에서도 클라이언트와 서버 프로세스라 부른다.

프로세스는 소켓(socket)을 통해 네트워크로 메시지를 보내고 받는다. 소켓은 호스트의 응용 계층과 전송 계층 간의 인터페이스이다.
또한 애플리케이션과 네트워크 사이의 API라고도 한다.

수신 프로세스를 식별하기 위해서는 1) 목적지 호스트의 IP 주소, 2) 목적지 호스트 내의 수신 프로세스를 명시하는 식별자인 포트 번호가 필요하다.

![socketAPI](./images/socketAPI.png)

### 응용 계층에서 사용할 수 있는 전송 계층 서비스
네트워크가 제공하는 하나 이상의 전송 프로토콜 중 어떤 것을 선택할 것인가? 또한 전송 계층 프로토콜이 애플리케이션에게 제공할 수 있는 서비스는 무엇인가?
1. 신뢰적 데이터 전송 : 데이터 손실 없이 목적지에 도착함을 보장함 (오디오/비디오 등은 손실 허용 애플리케이션)
2. 처리율 : 명시된 속도에서 보장된 가용 처리율을 제공함 (bandwidth-sensitive VS. elastic)
3. 시간 : 송신자가 소켓으로 내보내는 모든 비트가 수신자의 소켓에 100 ms 내에 도착할 것을 보장함 (실시간 상호작용 애플리케이션에서 사용)
4. 보안 : 기밀성, 데이터 무결성, 종단 인증 등

### 인터넷 전송 프로토콜
1. TCP (Transmission Control Protocol)
   - 연결지향형 서비스 : 핸드셰이킹 -> 전이중(full-duplex) 연결
   - 신뢰적인 데이터 전송 서비스 : 바이트 스트림이 손실되거나 중복되지 않음 (패킷 오버헤드)
   - 혼잡 제어 : 네트워크가 혼잡하면 프로세스 속도를 낮춤(대역폭을 공평하게 공유하도록!)
2. UDP(User Datagram Protocol)
   - 최소 서비스 모델을 가진 간단한 전송 프로토콜
   - 비연결형, 비신뢰적인 데이터 전송 서비스
   - 혼잡 제어를 하지 않아 데이터를 원하는 속도로 보낼 수 있음
- TLS(Transport Layer Security)
  - TLS로 강화된 TCP는 중요한 보안 서비스를 제공함
  - 애플리케이션 계층에서 구현!! 애플리케이션의 클라이언트와 서버 측 모두에 TLS 코드를 포함해야함
  - 송신 프로세스가 평문 데이터를 TLS 소켓에게 전달하면, 이를 암호화하여 TCP 소켓으로 전달함

앞에서 살펴본 네 가지 전송 계층 서비스 중 처리율과 시간 보장은 현재 인터넷에서 제대로 보장해 줄 수 없다. 
즉, 때로 시간 민감 애플리케이션에게 만족스런 서비스를 제공할 수 있으나 시간 혹은 대역폭 보장을 제공할 수는 없다.

## 애플리케이션 계층 프로토콜
네트워크 프로세스는 소켓으로 메시지를 보냄으로써 통신한다. 그렇다면 이 메시지는 어떻게 구성될까? 
응용 계층 프로토콜은 다른 종단 시스템에서 실행되는 애플리케이션의 프로세스가 서로 메시지를 보내는 방법을 정의한다.
- 교환 메시지 타입(요청 메시지와 응답 메시지)
- 여러 메시지 타입의 문법(메시지 내부의 필드와 필드 간의 구별 방법)
- 필드에 있는 정보의 의미
- 언제, 어떻게 프로세스가 메시지를 전송하고 응답하는지 결정하는 규칙

이러한 정보는 RFC에 명시되어 있다. 웹의 응용 계층 프로토콜인 HTTP를 제외하고 다른 많은 응용 계층 프로토콜은 독점이며 공중 도메인에서 구할 수 없다.
네트워크 애플리케이션은 응용 계층 프로토콜을 포함한다. 예를 들어 웹 애플리케이션은 HTML, 웹 브라우저, 웹 서버, 응용 계층 프로토콜을 포함하는 여러 요소들로 구성된다.
웹 응용 계층 프로토콜인 HTTP는 브라우저와 웹 서버 사이에서 교환되는 메시지의 포맷과 순서를 정의한다. 따라서 HTTP는 단지 웹 애플리케이션의 한 요소이다.

앞으로 5개의 주요 애플리케이션 분야로 웹, 전자메일, 디렉터리 서비스(DNS), 비디오 스트리밍(CDN), P2P 애플리케이션을 살펴보자.

# HTTP
WWW을 통해 인터넷은 대중에게 알려지기 시작했다.
웹은 온디맨드 방식으로 동작하기 때문에 사용자는 그들이 원할 때 원하는 것을 수신할 수 있다. 또한 모든 사람이 매우 낮은 비용으로 발행자가 될 수 있다.

웹의 응용 계층 프로토콜인 HTTP(HyperText Transfer Protocol)은 클라이언트 프로그램과 서버 프로그램으로 구현된다.
각기 다른 종단 시스템에서 클라이언트 프로그램과 서버 프로그램은 서로 HTTP 메시지를 교환하여 통신한다.
HTTP는 메시지의 구조 및 클라이언트와 서버가 메시지를 어떻게 교환하는지에 대해 정의하고 있다.

### 웹 전문 용어 정리
웹 페이지는 기본 HTML 파일과 여러 참조 객체(이미지, JS 등등)로 구성된다. 기본 HTML 파일은 페이지 내부의 다른 객체를 그 객체의 URL로 참조한다.
각 URL은 객체를 갖고 있는 서버의 호스트 이름과 객체의 경로 이름을 갖고 있다.
- `http://www.someSchool.edu/someDepartment/picture.gif`
- 호스트 이름 : http://www.someSchool.edu
- 경로 이름 : /someDepartment/picture

웹 브라우저는 HTTP의 클라이언트 측을 구현한다.(웹 클라이언트라 부름) 브라우저는 요구한 웹 페이지를 보여주고 여러 가지 특성을 제공한다.

웹 서버는 HTTP의 서버 측을 구현하며 URL로 각각을 지정할 수 있는 웹 객체를 갖고 있다. 인기 있는 웹 서버로는 Apache, 마이크로소프트의 Internet Information Sever 등이 있다.

## 개요
사용자가 웹 페이지를 요청할 때, 브라우저는 페이지 내부의 객체에 대한 HTTP 요청 메시지를 서버에 보낸다.
서버는 요청을 수신하고 객체를 포함하는 HTTP 응답 메시지로 응답한다.

HTTP는 TCP를 전송 프로토콜로 사용한다. HTTP 클라이언트는 먼저 서버에 TCP 연결을 시작한다.
일단 연결이 이루어지면, 브라우저와 서버 프로세스는 그들의 소켓 인터페이스를 통해 TCP로 접속한다!!

서버가 클라이언트에게 요청 파일을 보낼 때, 서버는 클라이언트에 관한 어떠한 상태 정보도 저장하지 않는다. 만약 특정 클라이언트가 몇 초 후에 같은 객체를 두 번 요청한다면,
잠시 전에 이미 그 객체를 보냈다고 서버가 알려주면 좋겠지만 서버는 이전에 한 일을 기억하지 않으므로 그 객체를 또 보낸다.
이렇게 HTTP 서버는 클라이언트에 대한 정보를 유지하지 않으므로, HTTP를 비상태(stateless) 프로토콜이라고 한다.

웹은 클라이언트-서버 구조를 사용한다. 웹 서버는 항상 켜져 있고, 고정 IP 주소를 가지며, 다른 잠재적인 수백만 브라우저로부터의 요청을 서비스한다.

## 비지속 연결과 지속 연결
- 비지속 연결 : 각 클라이언트의 요구와 서버의 응답 쌍이 분리된 TCP 연결을 통해 보내짐
- 지속 연결 : 모든 요구와 해당하는 응답들이 같은 TCP 연결상으로 보내짐







# SMTP


# DNS


# P2P 파일 분배

# 소켓 API
